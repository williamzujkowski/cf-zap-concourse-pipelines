---
# ZAP Automation Framework Plan: Baseline (Passive) Scan
#
# This plan performs a passive-only scan against the target URL.
# It spiders the application to discover pages, then waits for all
# passive scan rules to complete. No attack payloads are sent.
#
# Variables substituted at runtime:
#   ${TARGET_URL} - The URL to scan
#   ${FAIL_ON}    - Alert risk level that causes failure

env:
  contexts:
    - name: "baseline-scan-context"
      urls:
        - "${TARGET_URL}"
      includePaths:
        - "${TARGET_URL}.*"
  parameters:
    failOnError: true
    failOnWarning: false
    progressToStdout: true

jobs:
  # Configure passive scanning behavior
  - type: passiveScan-config
    parameters:
      maxAlertsPerRule: 10
      scanOnlyInScope: true

  # Spider the target to discover pages
  - type: spider
    parameters:
      context: "baseline-scan-context"
      maxDuration: 2
      maxDepth: 5
      maxChildren: 20

  # Wait for passive scan rules to finish processing
  - type: passiveScan-wait
    parameters:
      maxDuration: 5

  # Generate HTML report
  - type: report
    parameters:
      template: "traditional-html"
      reportDir: "/zap/wrk/reports"
      reportFile: "zap-baseline-report"
      reportTitle: "ZAP Baseline Scan Report"
      reportDescription: "Passive security scan results"

  # Generate JSON report for programmatic consumption
  - type: report
    parameters:
      template: "sarif-json"
      reportDir: "/zap/wrk/reports"
      reportFile: "zap-baseline-report"
      reportTitle: "ZAP Baseline Scan Report (SARIF)"

  # Exit with appropriate code based on alert threshold
  - type: exitStatus
    parameters:
      errorLevel: "${FAIL_ON}"
